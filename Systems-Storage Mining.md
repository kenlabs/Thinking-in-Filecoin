## 存储挖矿

存储挖矿系统是Filecoin协议的一部分。存储挖矿通过存储客户数据并产生证明信息来展示节点正确的存储了客户的数据。

存储挖矿是Filecoin协议最核心的部分之一，因为它提供了基于客户证明存储算力所需要的共识算法。根据矿工提交到网络的存储算力来选择矿工来生产区块并扩展区块链。

存储的单位为扇区。扇区向网络承诺某些存储将在承诺期内持续保留。为了参与存储挖矿，存储矿工必须：

* i)向系统添加存储，
* ii)证明在整个扇区的生命周期中维护其承诺的数据副本。

存储数据和生成证明是一个复杂的、高度可优化的过程，有许多可调优的选择。矿工应该探索设计空间，以达到：

* (a)满足协议和网络范围的限制，
* (b)满足客户的要求和期望（如交易中所标识的）
* (c)提供最具成本效益的运维

Filecoin规范的这一部分主要详细描述了这里必须做什么和应该做什么，并为实现者、矿工和用户的各种优化留下了充足的空间。在某些部分，我们描述了可以被其他更优化的版本取代的算法，但在这些情况下，满足协议约束很重要。协议约束被清楚地描述出来。由实现者决定，他们将偏离本文提出的算法，以确保他们的修改满足这些约束，特别是那些与协议安全性有关的约束。

#### 扇区

扇区是Filecoin的基本存储单元。

* 扇区有标准的大小，以及明确定义的时间增量的承诺。扇区大小的设计权衡了安全性和可用性。

* 扇区的生存期由存储市场决定，并设置扇区承诺的生存期。

在协议的第一个版本中，支持32GiB和64GiB扇区的大小。最大扇区生命周期由证明算法决定。扇区的最大生命周期最初为18个月。当一个扇区达到其生命周期的终点时，它自然会失效。此外，矿工还可以延长其扇区的生命周期。当矿工履行他们的承诺时，他们就会获得区奖励并获得质押。

当存储矿工和客户在Filecoin的存储市场上互相匹配时，就形成了独立交易。Filecoin协议目前没有区分与真实客户匹配的矿工和自我产生交易的矿工。然而，承诺容量是这样一种构造：其引入是为了使得自我交易变得不必要和经济上不合理。在该网络的早期设计中，只有填充交易的扇区才可以让矿工获得赢得区块奖励的可能性。这导致人们认为，矿工会同时扮演存储提供者和客户端的角色，攻击和利用网络，制造一种恶意的自我交易。

如果一个扇区只有部分交易，该网络会将其余部分视为承诺容量。同样，没有交易的扇区被称为承诺容量扇区；矿工因向网络证明他们质押承诺容量而获得奖励，并被鼓励寻找需要存储的客户。当矿工发现存储需求时，它们可以升级其承诺容量扇区，以向付费客户收取交易费的形式赚取额外收入。更多关于添加存储和升级扇区的详细信息，请参见添加存储。

承诺容量扇区提高了矿工存储客户数据的动机，但它们并不能完全解决问题。存储真实的客户文件为存储矿工增加了一些操作开销。在某些情况下——例如，如果矿工对区块奖励的估值远高于交易费用——矿工可能仍会选择完全忽略客户数据，而只是存储承诺容量，以尽可能快地增加存储能力，以追求区块奖励。这将减少Filecoin的效用，并限制客户在网络上存储数据的能力。Filecoin通过引入验证客户的概念来解决这个问题。经过验证的客户由一个去中心化的验证者网络进行认证。一旦得到验证，他们就可以根据DataCap的大小，将预先确定的客户交易数据发布到存储市场。与没有客户交易的部门相比，有客户交易的部门获得了更多的存储能力，因此获得了更多的区块奖励。这为存储矿工存储客户数据提供了额外的动力。

验证并不是为了稀缺——任何有真实数据存储在Filecoin上的人都可以很容易地获得验证。尽管验证者可以自由地（负责地和透明地）分配验证客户datacap，以使真实数据存储更容易，但总体效果应该是存储在Filecoin上的有用数据的比例显著增加。

一旦一个扇区被填满（无论是客户数据还是承诺容量），未密封的扇区和证明树合并为一个根UnsealedSectorCID。然后，密封过程将未密封的扇区编码（使用CBOR）为密封扇区，形成的根为SealedSectorCID。

下图表显示了一个未密封扇区和一个密封扇区的组成。

![](https://spec.filecoin.io/systems/filecoin_mining/sector/sectors.png)